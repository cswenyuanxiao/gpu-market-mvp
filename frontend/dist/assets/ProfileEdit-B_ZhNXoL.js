import{j as e}from"./react-query-BGeIQRPr.js";import{r as n}from"./react-CTDr35rJ.js";import{u as N,a as c}from"./index-DvhTShKy.js";import{F as p}from"./FormField-DCIQlhW3.js";import{A as E,h as b,I as S,U as C,B as j,o as F}from"./antd-DlFti5e9.js";function R(){const[a,h]=n.useState(""),[U,f]=n.useState(""),[u,v]=n.useState(null),[d,m]=n.useState(null),[y,x]=n.useState(!1),{login:w}=N();n.useEffect(()=>{localStorage.getItem("token")&&c("/api/users/me").then(async l=>{const i=await l.json();h(i.display_name||""),f(i.display_name||""),m(i.avatar_path||null)}).catch(()=>{})},[]);async function g(t){var l,i;t.preventDefault(),x(!0);try{if((a||"").trim().length>0){const r=await c("/api/users/me",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({display_name:a.trim()})});if(!r.ok){const o=((l=await r.json().catch(()=>({})))==null?void 0:l.error)||"Update failed";window.dispatchEvent(new CustomEvent("app-toast",{detail:{text:o,type:"error"}}));return}const s=await r.json().catch(()=>({}));s!=null&&s.token&&w(s.token),window.dispatchEvent(new CustomEvent("app-toast",{detail:{text:"Profile updated",type:"success"}})),f(a)}if(u){const r=new FormData;r.append("avatar",u);const s=await c("/api/users/me/avatar",{method:"POST",body:r});if(!s.ok){const o=((i=await s.json().catch(()=>({})))==null?void 0:i.error)||"Upload failed";window.dispatchEvent(new CustomEvent("app-toast",{detail:{text:o,type:"error"}}));return}window.dispatchEvent(new CustomEvent("app-toast",{detail:{text:"Avatar updated",type:"success"}}));try{const o=await(await c("/api/users/me")).json();m(o.avatar_path||null),v(null)}catch{}}}finally{x(!1)}}return e.jsxs("div",{className:"form-container",children:[e.jsxs("div",{className:"form-description",children:[e.jsx("h3",{children:"Edit Profile"}),e.jsx("p",{children:"Update your profile information and avatar."})]}),e.jsxs("form",{onSubmit:g,className:"modern-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("div",{className:"section-title",children:"Profile Information"}),e.jsx("div",{className:"form-field",children:e.jsx(p,{label:"Display Name",htmlFor:"display-name",children:e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx(E,{size:64,src:d||void 0,icon:e.jsx(b,{}),children:a==null?void 0:a[0]}),e.jsx(S,{id:"display-name",value:a,onChange:t=>h(t.target.value),placeholder:"Enter your display name"})]})})})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("div",{className:"section-title",children:"Avatar"}),e.jsx("div",{className:"form-field",children:e.jsx(p,{label:"Upload New Avatar",htmlFor:"avatar",children:e.jsx(C,{accept:"image/*",showUploadList:!1,beforeUpload:t=>(v(t),m(URL.createObjectURL(t)),!1),children:e.jsx(j,{icon:e.jsx(F,{}),children:"Choose Image"})})})}),d&&e.jsx("div",{className:"form-field",children:e.jsx(p,{label:"Preview",children:e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx("img",{src:d,style:{width:96,height:96,objectFit:"cover"},className:"rounded-lg border"}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("p",{children:"New avatar preview"}),e.jsx("p",{children:'Click "Save" to apply changes'})]})]})})})]}),e.jsx("div",{className:"form-actions",children:e.jsx(j,{type:"primary",loading:y,htmlType:"submit",className:"submit-btn",children:"Save Changes"})})]})]})}export{R as default};
