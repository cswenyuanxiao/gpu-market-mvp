import{j as e}from"./react-query-BGeIQRPr.js";import{r as v,u as S,e as b,L}from"./react-CTDr35rJ.js";import{u as N,a as F}from"./index-BWr4Oq7s.js";import{F as d}from"./FormField-DCIQlhW3.js";import{u as E,a as T,o as k,s as p}from"./zod-SQF3v9p3.js";import{B as C}from"./antd-C_PMe3Fi.js";const I=k({username:p().min(1,"Username is required"),password:p().min(1,"Password is required")});function J(){var i,m;const[u,o]=v.useState(!1),g=S(),t=b(),{login:f}=N(),{register:a,handleSubmit:h,formState:{errors:n}}=E({resolver:T(I)});async function w(y){var c,l;o(!0);try{const r=await F("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)});if(!r.ok){const j=((c=await r.json().catch(()=>({})))==null?void 0:c.error)||"Login failed";window.dispatchEvent(new CustomEvent("app-toast",{detail:{text:j,type:"error"}}));return}const x=await r.json();f(x.token||""),window.dispatchEvent(new CustomEvent("app-toast",{detail:{text:"Logged in",type:"success"}}));let s;try{s=sessionStorage.getItem("from")||void 0,s&&sessionStorage.removeItem("from")}catch{}s||(s=(l=t==null?void 0:t.state)==null?void 0:l.from),s||(s="/my"),g(s,{replace:!0})}finally{o(!1)}}return e.jsxs("div",{className:"container py-4",style:{maxWidth:420},children:[e.jsx("h3",{className:"mb-3",children:"Login"}),e.jsxs("form",{onSubmit:h(w),children:[e.jsx(d,{label:"Username",htmlFor:"login-username",error:(i=n.username)==null?void 0:i.message,children:e.jsx("input",{id:"login-username",className:"form-control",...a("username")})}),e.jsx(d,{label:"Password",htmlFor:"login-password",error:(m=n.password)==null?void 0:m.message,children:e.jsx("input",{id:"login-password",type:"password",className:"form-control",...a("password")})}),e.jsx(C,{type:"primary",htmlType:"submit",block:!0,loading:u,children:"Sign In"})]}),e.jsxs("div",{className:"mt-3",children:["New here? ",e.jsx(L,{to:"/register",children:"Create an account"})]})]})}export{J as default};
