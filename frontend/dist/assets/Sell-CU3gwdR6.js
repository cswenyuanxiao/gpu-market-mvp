const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ImageUploader-DWnjEkzb.js","assets/react-query-BGeIQRPr.js","assets/react-CTDr35rJ.js"])))=>i.map(i=>d[i]);
import{a as F,_ as V}from"./index-DRfykArT.js";import{j as e}from"./react-query-BGeIQRPr.js";import{r as d,u as E}from"./react-CTDr35rJ.js";import{F as a}from"./FormField-DCIQlhW3.js";import{u as T,a as _,C as n,o as M,s as m,c as g,e as B}from"./zod-SQF3v9p3.js";import{I as c,l as N,B as P}from"./antd-C_PMe3Fi.js";const U=d.lazy(()=>V(()=>import("./ImageUploader-DWnjEkzb.js"),__vite__mapDeps([0,1,2]))),R=["NVIDIA","AMD","Intel"],L=M({title:m().min(1,"Title is required"),price:g.number().min(1,"Price must be ≥ 1").max(5e5,"Price too large"),condition:B(["New","Used"]),brand:m().optional().refine(l=>!l||R.includes(l),"Brand must be NVIDIA, AMD, or Intel"),vram:g.number().int().min(0,"VRAM must be ≥ 0").max(64,"VRAM must be ≤ 64").optional(),desc:m().max(2e3).optional()});function J(){var p,x,f,j,u,b;const[l,I]=d.useState([]),[w,h]=d.useState(!1),S=E(),{register:O,handleSubmit:A,formState:{errors:i},control:t}=T({resolver:_(L),defaultValues:{condition:"Used"}});async function C(s){var v;const r=new FormData;r.set("title",s.title),r.set("price",String(s.price)),r.set("condition",s.condition),s.brand&&r.set("brand",s.brand),s.vram!==void 0&&r.set("vram_gb",String(s.vram)),s.desc&&r.set("description",s.desc),l.slice(0,10).forEach(o=>r.append("images",o)),h(!0);try{const o=await F("/api/gpus",{method:"POST",body:r});if(!o.ok){const y=((v=await o.json().catch(()=>({})))==null?void 0:v.error)||"Create failed";window.dispatchEvent(new CustomEvent("app-toast",{detail:{text:y,type:"error"}}));return}const D=await o.json();window.dispatchEvent(new CustomEvent("app-toast",{detail:{text:"Created",type:"success"}})),S(`/g/${D.id}`)}finally{h(!1)}}return e.jsxs("div",{className:"form-container",children:[e.jsx("h3",{children:"Create Listing"}),e.jsxs("form",{onSubmit:A(C),className:"modern-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{className:"section-title",children:"Basic Information"}),e.jsxs("div",{className:"form-grid",children:[e.jsx("div",{className:"form-field",children:e.jsx(a,{label:"Title",htmlFor:"title",error:(p=i.title)==null?void 0:p.message,hint:"Short, descriptive title",children:e.jsx(n,{name:"title",control:t,render:({field:s})=>e.jsx(c,{id:"title",...s})})})}),e.jsx("div",{className:"form-field",children:e.jsx(a,{label:"Price",htmlFor:"price",error:(x=i.price)==null?void 0:x.message,hint:"£",children:e.jsx(n,{name:"price",control:t,render:({field:s})=>e.jsx(c,{id:"price",...s})})})}),e.jsx("div",{className:"form-field",children:e.jsx(a,{label:"Condition",htmlFor:"cond",error:(f=i.condition)==null?void 0:f.message,children:e.jsx(n,{name:"condition",control:t,render:({field:s})=>e.jsx(N,{id:"cond",value:s.value,onChange:r=>s.onChange(r),options:[{value:"New",label:"New"},{value:"Used",label:"Used"}]})})})}),e.jsx("div",{className:"form-field",children:e.jsx(a,{label:"Brand",htmlFor:"brand",error:(j=i.brand)==null?void 0:j.message,hint:"NVIDIA, AMD, or Intel",children:e.jsx(n,{name:"brand",control:t,render:({field:s})=>e.jsx(N,{id:"brand",value:s.value,onChange:r=>s.onChange(r),options:[{value:"NVIDIA",label:"NVIDIA"},{value:"AMD",label:"AMD"},{value:"Intel",label:"Intel"}],allowClear:!0})})})}),e.jsx("div",{className:"form-field",children:e.jsx(a,{label:"VRAM (GB)",htmlFor:"vram",error:(u=i.vram)==null?void 0:u.message,hint:"0 - 64",children:e.jsx(n,{name:"vram",control:t,render:({field:s})=>e.jsx(c,{id:"vram",...s})})})})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{className:"section-title",children:"Description"}),e.jsx("div",{className:"form-field-full",children:e.jsx(a,{label:"Description",htmlFor:"desc",error:(b=i.desc)==null?void 0:b.message,hint:"Optional. Up to 2000 characters",children:e.jsx(n,{name:"desc",control:t,render:({field:s})=>e.jsx(c.TextArea,{id:"desc",rows:6,...s})})})})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h4",{className:"section-title",children:"Images"}),e.jsx("div",{className:"form-field-full",children:e.jsx(d.Suspense,{fallback:null,children:e.jsx(U,{onChange:I})})})]}),e.jsx("div",{className:"form-actions",children:e.jsx(P,{type:"primary",htmlType:"submit",loading:w,className:"submit-btn",children:"Submit"})})]})]})}export{J as default};
