import{j as t}from"./react-query-BGeIQRPr.js";import{r as m}from"./react-CTDr35rJ.js";import{B as c,t as b,U,u as $,v as z,j as B,w as W,x as E}from"./antd-DlFti5e9.js";function M({onChange:d,maxImages:g=10,maxSizeMb:l=5,pixelLimit:i=25e6}){const[r,u]=m.useState([]),j=m.useRef(null),[w,h]=m.useState(!1);m.useEffect(()=>{d(r.map(e=>e.file))},[r,d]);function N(){var e;(e=j.current)==null||e.click()}async function v(e){if(!e)return;const s=[],n=[];try{for(let o=0;o<e.length;o++){const a=e.item(o);if(!a||!a.type.startsWith("image/"))continue;if(r.length+s.length>=g)break;const f=a.size>l*1024*1024,x=URL.createObjectURL(a);n.push(x);const p=await O(x).catch(()=>({width:0,height:0})),L=p.width*p.height>i;s.push({file:a,url:x,width:p.width,height:p.height,tooLarge:f||L})}s.some(o=>o.tooLarge)&&window.dispatchEvent(new CustomEvent("app-toast",{detail:{text:`Some images exceed limit (${l}MB or ${i.toLocaleString()} px)`,type:"warning"}})),u(o=>[...o,...s])}finally{}}function R(e){const s=r[e];s&&URL.revokeObjectURL(s.url),u(n=>n.filter((o,a)=>a!==e))}function y(e,s){u(n=>{const o=n.slice(),a=e+s;if(a<0||a>=o.length)return n;const f=o[e];return o[e]=o[a],o[a]=f,o})}function k(e){u(s=>{if(e<=0)return s;const n=s.slice(),[o]=n.splice(e,1);return o?(n.unshift(o),n):s})}function C(e){e.preventDefault(),h(!1),v(e.dataTransfer.files)}function D(e){e.preventDefault(),h(!0)}function I(){h(!1)}return t.jsxs("div",{children:[t.jsx("input",{ref:j,type:"file",multiple:!0,accept:"image/*",className:"d-none",onChange:e=>v(e.target.files)}),t.jsxs("div",{className:"d-flex align-items-center gap-2 mb-3",children:[t.jsx(c,{type:"default",icon:t.jsx(b,{}),onClick:N,size:"small",children:"Add Images"}),t.jsxs("small",{className:"text-muted",children:["Up to ",g," images, ≤ ",l,"MB, ≤ ",i.toLocaleString()," px"]})]}),t.jsxs("div",{className:`p-4 border-2 border-dashed rounded-lg transition-colors ${w?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDrop:C,onDragOver:D,onDragLeave:I,children:[t.jsx("div",{className:"text-center text-gray-500 mb-3",children:t.jsxs(U.Dragger,{disabled:!0,children:[t.jsx("p",{className:"ant-upload-drag-icon",children:t.jsx(b,{})}),t.jsx("p",{className:"ant-upload-text",children:"Drag & drop images here"})]})}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3",children:r.map((e,s)=>t.jsx("div",{className:"relative group",children:t.jsxs("div",{className:"relative",children:[t.jsx("img",{src:e.url,width:96,height:96,style:{objectFit:"cover"},loading:"lazy",className:`w-24 h-24 rounded-lg border-2 ${e.tooLarge?"border-red-500":"border-gray-200"}`}),t.jsx("div",{className:"absolute top-1 left-1",children:t.jsx($,{count:s===0?"Cover":s+1,style:{backgroundColor:s===0?"#1890ff":"#666",fontSize:"10px",padding:"2px 6px"}})}),t.jsxs("div",{className:"absolute bottom-1 left-1 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[t.jsx(c,{type:"text",size:"small",icon:t.jsx(z,{}),onClick:()=>y(s,-1),disabled:s===0,title:"Move left",style:{padding:"2px",minWidth:"auto"}}),t.jsx(c,{type:"text",size:"small",icon:t.jsx(B,{}),onClick:()=>y(s,1),disabled:s===r.length-1,title:"Move right",style:{padding:"2px",minWidth:"auto"}}),t.jsx(c,{type:"text",size:"small",icon:t.jsx(W,{}),onClick:()=>k(s),disabled:s===0,title:"Set as cover",style:{padding:"2px",minWidth:"auto"}})]}),t.jsx(c,{type:"text",size:"small",icon:t.jsx(E,{}),onClick:()=>R(s),title:"Remove",danger:!0,className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity",style:{padding:"2px",minWidth:"auto"}})]})},s))})]})]})}function O(d){return new Promise((g,l)=>{const i=new Image;i.onload=()=>g({width:i.naturalWidth,height:i.naturalHeight}),i.onerror=l,i.src=d})}export{M as default};
