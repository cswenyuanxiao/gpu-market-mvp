const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ImageUploader-DWnjEkzb.js","assets/react-query-BGeIQRPr.js","assets/react-CTDr35rJ.js"])))=>i.map(i=>d[i]);
import{a as g,_ as U}from"./index-DYY5_Kt0.js";import{j as e}from"./react-query-BGeIQRPr.js";import{i as _,r as o,u as I}from"./react-CTDr35rJ.js";import{F as a}from"./FormField-DCIQlhW3.js";import{u as C,a as T,C as V,o as P,s as d,c as v,e as B}from"./zod-SQF3v9p3.js";import{B as M}from"./antd-B0daGbTI.js";const R=o.lazy(()=>U(()=>import("./ImageUploader-DWnjEkzb.js"),__vite__mapDeps([0,1,2]))),L=["NVIDIA","AMD"],$=P({title:d().min(1,"Title is required"),price:v.number().min(1,"Price must be ≥ 1").max(5e5,"Price too large"),condition:B(["New","Used"]),brand:d().optional().refine(s=>!s||L.includes(s),"Brand must be NVIDIA or AMD"),vram:v.number().int().min(0,"VRAM must be ≥ 0").max(64,"VRAM must be ≤ 64").optional(),desc:d().max(2e3).optional()});function H(){var m,p,u,h,x,f;const{id:s}=_(),[N,w]=o.useState(!0),[y,E]=o.useState([]),F=I(),{register:n,handleSubmit:S,formState:{errors:i},reset:l,control:A}=C({resolver:T($),defaultValues:{condition:"Used"}});o.useEffect(()=>{s&&(async()=>{try{const t=await(await g(`/api/gpus/${s}`)).json();l({title:t.title||"",price:t.price??"",condition:t.condition||"Used",brand:t.brand||"",vram:t.vram_gb??"",desc:t.description||""})}finally{w(!1)}})()},[s,l]);async function D(r){var j;if(!s)return;const t=new FormData;t.set("title",r.title),t.set("price",String(r.price)),t.set("condition",r.condition),r.brand&&t.set("brand",r.brand),r.vram!==void 0&&t.set("vram_gb",String(r.vram)),r.desc&&t.set("description",r.desc),y.slice(0,10).forEach(c=>t.append("images",c));const b=await g(`/api/gpus/${s}`,{method:"PUT",body:t});if(!b.ok){const c=((j=await b.json().catch(()=>({})))==null?void 0:j.error)||"Update failed";window.dispatchEvent(new CustomEvent("app-toast",{detail:{text:c,type:"error"}}));return}window.dispatchEvent(new CustomEvent("app-toast",{detail:{text:"Updated",type:"success"}})),F(`/g/${s}`)}return N?e.jsx("div",{className:"container py-3",children:"Loading..."}):e.jsxs("div",{className:"container py-3",style:{maxWidth:720},children:[e.jsx("h3",{children:"Edit Listing"}),e.jsxs("form",{onSubmit:S(D),children:[e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsx(a,{label:"Title",htmlFor:"title",error:(m=i.title)==null?void 0:m.message,children:e.jsx("input",{id:"title",className:"form-control",...n("title")})}),e.jsx(a,{label:"Description",htmlFor:"desc",error:(p=i.desc)==null?void 0:p.message,children:e.jsx("textarea",{id:"desc",className:"form-control",rows:6,...n("desc")})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(a,{label:"Price",htmlFor:"price",error:(u=i.price)==null?void 0:u.message,hint:"In USD, ≥ 1",children:e.jsx("input",{id:"price",className:"form-control",...n("price")})}),e.jsx(a,{label:"Condition",htmlFor:"cond",error:(h=i.condition)==null?void 0:h.message,children:e.jsx(V,{name:"condition",control:A,render:({field:r})=>e.jsxs("select",{id:"cond",className:"form-select",value:r.value,onChange:t=>r.onChange(t.target.value),children:[e.jsx("option",{value:"New",children:"New"}),e.jsx("option",{value:"Used",children:"Used"})]})})}),e.jsx(a,{label:"Brand",htmlFor:"brand",error:(x=i.brand)==null?void 0:x.message,hint:"NVIDIA or AMD",children:e.jsx("input",{id:"brand",className:"form-control",...n("brand")})}),e.jsx(a,{label:"VRAM (GB)",htmlFor:"vram",error:(f=i.vram)==null?void 0:f.message,hint:"0 - 64",children:e.jsx("input",{id:"vram",className:"form-control",...n("vram")})})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx(o.Suspense,{fallback:null,children:e.jsx(R,{onChange:E})})}),e.jsx(M,{type:"primary",htmlType:"submit",children:"Save"})]})]})}export{H as default};
