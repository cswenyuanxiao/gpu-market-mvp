const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ImageUploader-DWnjEkzb.js","assets/react-query-BGeIQRPr.js","assets/react-CTDr35rJ.js"])))=>i.map(i=>d[i]);
import{a as F,_ as V}from"./index-BFCOulkZ.js";import{j as e}from"./react-query-BGeIQRPr.js";import{r as c,u as E}from"./react-CTDr35rJ.js";import{F as i}from"./FormField-iyrhpl26.js";import{u as T,a as _,C as n,o as M,s as m,c as v,e as U}from"./zod-SQF3v9p3.js";import{I as d,l as w,B}from"./antd-C_PMe3Fi.js";const P=c.lazy(()=>V(()=>import("./ImageUploader-DWnjEkzb.js"),__vite__mapDeps([0,1,2]))),R=["NVIDIA","AMD"],L=M({title:m().min(1,"Title is required"),price:v.number().min(1,"Price must be ≥ 1").max(5e5,"Price too large"),condition:U(["New","Used"]),brand:m().optional().refine(l=>!l||R.includes(l),"Brand must be NVIDIA or AMD"),vram:v.number().int().min(0,"VRAM must be ≥ 0").max(64,"VRAM must be ≤ 64").optional(),desc:m().max(2e3).optional()});function H(){var h,u,x,b,j,g;const[l,S]=c.useState([]),[y,p]=c.useState(!1),A=E(),{register:O,handleSubmit:I,formState:{errors:s},control:a}=T({resolver:_(L),defaultValues:{condition:"Used"}});async function C(r){var f;const t=new FormData;t.set("title",r.title),t.set("price",String(r.price)),t.set("condition",r.condition),r.brand&&t.set("brand",r.brand),r.vram!==void 0&&t.set("vram_gb",String(r.vram)),r.desc&&t.set("description",r.desc),l.slice(0,10).forEach(o=>t.append("images",o)),p(!0);try{const o=await F("/api/gpus",{method:"POST",body:t});if(!o.ok){const N=((f=await o.json().catch(()=>({})))==null?void 0:f.error)||"Create failed";window.dispatchEvent(new CustomEvent("app-toast",{detail:{text:N,type:"error"}}));return}const D=await o.json();window.dispatchEvent(new CustomEvent("app-toast",{detail:{text:"Created",type:"success"}})),A(`/g/${D.id}`)}finally{p(!1)}}return e.jsxs("div",{className:"container py-3",style:{maxWidth:720},children:[e.jsx("h3",{children:"Create Listing"}),e.jsxs("form",{onSubmit:I(C),children:[e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsx(i,{label:"Title",htmlFor:"title",error:(h=s.title)==null?void 0:h.message,hint:"Short, descriptive title",children:e.jsx(n,{name:"title",control:a,render:({field:r})=>e.jsx(d,{id:"title",...r})})}),e.jsx(i,{label:"Description",htmlFor:"desc",error:(u=s.desc)==null?void 0:u.message,hint:"Optional. Up to 2000 characters",children:e.jsx(n,{name:"desc",control:a,render:({field:r})=>e.jsx(d.TextArea,{id:"desc",rows:6,...r})})})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(i,{label:"Price",htmlFor:"price",error:(x=s.price)==null?void 0:x.message,hint:"In USD, ≥ 1",children:e.jsx(n,{name:"price",control:a,render:({field:r})=>e.jsx(d,{id:"price",...r})})}),e.jsx(i,{label:"Condition",htmlFor:"cond",error:(b=s.condition)==null?void 0:b.message,children:e.jsx(n,{name:"condition",control:a,render:({field:r})=>e.jsx(w,{id:"cond",value:r.value,onChange:t=>r.onChange(t),options:[{value:"New",label:"New"},{value:"Used",label:"Used"}]})})}),e.jsx(i,{label:"Brand",htmlFor:"brand",error:(j=s.brand)==null?void 0:j.message,hint:"NVIDIA or AMD",children:e.jsx(n,{name:"brand",control:a,render:({field:r})=>e.jsx(w,{id:"brand",value:r.value,onChange:t=>r.onChange(t),options:[{value:"NVIDIA",label:"NVIDIA"},{value:"AMD",label:"AMD"}],allowClear:!0})})}),e.jsx(i,{label:"VRAM (GB)",htmlFor:"vram",error:(g=s.vram)==null?void 0:g.message,hint:"0 - 64",children:e.jsx(n,{name:"vram",control:a,render:({field:r})=>e.jsx(d,{id:"vram",...r})})})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx(c.Suspense,{fallback:null,children:e.jsx(P,{onChange:S})})}),e.jsx(B,{type:"primary",htmlType:"submit",loading:y,children:"Submit"})]})]})}export{H as default};
