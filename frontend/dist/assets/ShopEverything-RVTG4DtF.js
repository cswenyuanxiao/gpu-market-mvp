const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DetailsModal-CLJe_zgN.js","assets/react-query-BGeIQRPr.js","assets/react-CTDr35rJ.js","assets/DetailsView-BYm_lOqh.js","assets/format-CopOq-7K.js","assets/antd-DlFti5e9.js"])))=>i.map(i=>d[i]);
import{b as T,a as D,_ as M}from"./index-DNCDa-yo.js";import{j as e,u as U}from"./react-query-BGeIQRPr.js";import{r as a}from"./react-CTDr35rJ.js";import{I as P,T as I,n as A,B as h,R as E,S as O,r as L,D as Q}from"./antd-DlFti5e9.js";import{G as z}from"./GpuCard-_124Tsb-.js";import"./format-CopOq-7K.js";function k(){const b=a.useMemo(()=>new URLSearchParams(location.search),[location.search]),S=a.useCallback(()=>Object.fromEntries(b.entries()),[b]),o=a.useCallback(l=>{const u=new URLSearchParams(location.search);Object.entries(l).forEach(([t,c])=>{c===void 0||c===""?u.delete(t):u.set(t,String(c))}),history.replaceState({},"",`?${u.toString()}`)},[]);return{getAll:S,setAll:o}}function W({onApply:b}){const{getAll:S,setAll:o}=k(),l=S(),[u,t]=a.useState(l.q||""),[c,n]=a.useState(l.min||""),[x,_]=a.useState(l.max||""),[j,N]=a.useState(l.brand||""),[v,m]=a.useState(l.vram_min||""),[g,p]=a.useState(l.condition||"");return a.useEffect(()=>{o({q:u,min:c,max:x,brand:j,vram_min:v,condition:g})},[u,c,x,j,v,g,o]),e.jsxs("div",{children:[e.jsx(P,{className:"mb-2",placeholder:"Search title or description",value:u,onChange:i=>t(i.target.value)}),e.jsxs("div",{className:"d-flex gap-2 mb-2",children:[e.jsx(I,{placeholder:"Min price",value:c===""?void 0:Number(c),onChange:i=>n(i==null?"":String(i)),min:0,style:{width:"100%"}}),e.jsx(I,{placeholder:"Max price",value:x===""?void 0:Number(x),onChange:i=>_(i==null?"":String(i)),min:0,style:{width:"100%"}})]}),e.jsxs("div",{className:"d-flex gap-2 mb-2",children:[e.jsx(A,{value:j,style:{minWidth:140},onChange:i=>N(i),options:[{value:"",label:"Any brand"},{value:"NVIDIA",label:"NVIDIA"},{value:"AMD",label:"AMD"}]}),e.jsx(A,{value:v,style:{minWidth:140},onChange:i=>m(String(i)),options:[{value:"",label:"Any VRAM"},{value:"4",label:"≥ 4GB"},{value:"6",label:"≥ 6GB"},{value:"8",label:"≥ 8GB"},{value:"12",label:"≥ 12GB"},{value:"16",label:"≥ 16GB"}]})]}),e.jsx(A,{className:"mb-2",value:g,onChange:i=>p(i),options:[{value:"",label:"Any condition"},{value:"New",label:"New"},{value:"Used",label:"Used"}]}),e.jsxs("div",{className:"d-flex gap-2 align-items-center",children:[e.jsx(h,{type:"primary",onClick:()=>b({q:u,min:c,max:x,brand:j,vram_min:v,condition:g,page:"1"}),children:"Search"}),e.jsx(h,{onClick:()=>{t(""),n(""),_(""),N(""),m(""),p(""),b({q:"",min:"",max:"",brand:"",vram_min:"",condition:"",page:"1"})},children:"Clear all"})]})]})}const Z=a.lazy(()=>M(()=>import("./DetailsModal-CLJe_zgN.js"),__vite__mapDeps([0,1,2,3,4,5])));function ee(){var C;const{getAll:b,setAll:S}=k(),o=b(),[l,u]=a.useState(o.q||""),[t,c]=a.useState(o.sort||"price_desc"),[n,x]=a.useState({min:o.min||"",max:o.max||"",brand:o.brand||"",vram_min:o.vram_min||"",condition:o.condition||""}),[_,j]=a.useState(null),[N,v]=a.useState(!1),[m,g]=a.useState(Number(o.page||"1")),[p]=a.useState(12);a.useEffect(()=>T("Shop Everything — GPU Market"),[]);const i=a.useMemo(()=>{let s="newest";t==="price_asc"?s="price_asc":t==="price_desc"?s="price_desc":(t==="date_new"||t==="featured"||t==="best"||t==="alpha_asc"||t==="alpha_desc"||t==="date_old")&&(s="newest");const r=new URLSearchParams;return l&&r.set("q",l),r.set("sort",s),Object.entries(n).forEach(([y,f])=>{f&&r.set(y,String(f))}),r.set("page",String(m)),r.set("per",String(p)),r},[l,t,n,m,p]),{data:d,isLoading:w,isError:V,refetch:q,isFetching:B}=U({queryKey:["search",l,t,n,m,p],queryFn:async()=>{S({q:l,sort:t,page:String(m),...n});try{const r=await(await D("/api/search?"+i.toString())).json().catch(()=>({})),y=Array.isArray(r.results)?r.results:[],f=Number(r.total||y.length||0),R=Number(r.page||m),G=Number(r.per||p);return{total:f,page:R,per:G,results:y}}catch{return{total:0,page:m,per:p,results:[]}}},placeholderData:s=>s,staleTime:3e4,retry:2});a.useEffect(()=>{const s=document.querySelector(".container");s&&s.scrollIntoView({behavior:"smooth",block:"start"})},[m]);function F(){M(()=>import("./DetailsModal-CLJe_zgN.js"),__vite__mapDeps([0,1,2,3,4,5]))}return e.jsxs("div",{className:"page-shop-everything container py-3",children:[e.jsxs("div",{className:"d-flex gap-2 my-3 align-items-center",children:[e.jsx(P,{id:"globalSearchInput",placeholder:"Search GPUs...",value:l,onChange:s=>u(s.target.value),style:{flex:1}}),e.jsx(A,{value:t,style:{width:180},onChange:s=>c(s),options:[{value:"featured",label:"Featured"},{value:"best",label:"Best selling"},{value:"alpha_asc",label:"Alphabetically, A-Z"},{value:"alpha_desc",label:"Alphabetically, Z-A"},{value:"price_asc",label:"Price, low to high"},{value:"price_desc",label:"Price, high to low"},{value:"date_old",label:"Date, old to new"},{value:"date_new",label:"Date, new to old"}]}),e.jsx(h,{onClick:()=>{c("price_desc")},children:"Reset sort"}),e.jsx(h,{type:"primary",onClick:()=>q(),children:"Search"}),e.jsx(h,{onClick:()=>v(!0),children:"Filters"})]}),e.jsx("div",{children:e.jsxs("div",{children:[V&&e.jsx("div",{className:"my-4",children:e.jsx(E,{status:"error",title:"Failed to load list",subTitle:"Please try again later."})}),e.jsxs("div",{className:"product-grid",onMouseEnter:F,children:[(w||B)&&e.jsx(e.Fragment,{children:Array.from({length:8}).map((s,r)=>e.jsx("div",{className:"loading-card",children:e.jsx("div",{className:"loading-placeholder",children:e.jsx(O,{})})},r))}),!w&&(Array.isArray(d==null?void 0:d.results)?d==null?void 0:d.results:[]).map(s=>e.jsx("div",{children:e.jsx(z,{gpu:s,onDetails:async r=>{const f=await(await D(`/api/gpus/${r}`)).json();j(f)}})},s.id)),!w&&(((C=d==null?void 0:d.results)==null?void 0:C.length)||0)===0&&e.jsx("div",{children:e.jsx("div",{className:"my-4",children:e.jsx(E,{status:"info",title:"No results",subTitle:l||n.min||n.max||n.brand||n.vram_min||n.condition?"Try adjusting filters or sorting options.":"Browse by series from the top menu or apply filters to get started.",extra:l||n.min||n.max||n.brand||n.vram_min||n.condition?e.jsx("div",{className:"d-flex gap-2 justify-content-center",children:e.jsx(h,{onClick:()=>{u(""),x({min:"",max:"",brand:"",vram_min:"",condition:""}),g(1)},children:"Clear all filters"})}):e.jsxs("div",{className:"d-flex gap-2 justify-content-center",children:[e.jsx(h,{href:"/?brand=NVIDIA&vram_min=12",children:"NVIDIA 40 Series"}),e.jsx(h,{href:"/?brand=NVIDIA&vram_min=8",children:"NVIDIA 30 Series"}),e.jsx(h,{href:"/?brand=AMD&vram_min=12",children:"AMD 7000 Series"}),e.jsx(h,{href:"/?brand=AMD&vram_min=8",children:"AMD 6000 Series"})]})})})})]}),e.jsx("div",{className:"d-flex justify-content-center mt-3",children:e.jsx(L,{current:m,pageSize:p,total:(d==null?void 0:d.total)||0,onChange:s=>g(s),showSizeChanger:!1})})]})}),e.jsxs(Q,{open:N,onClose:()=>v(!1),children:[e.jsx("h5",{className:"mb-3",children:"Filters"}),e.jsx(W,{onApply:s=>{v(!1),x(r=>({...r,...s})),g(1)}})]}),e.jsx(a.Suspense,{fallback:null,children:e.jsx(Z,{item:_,onClose:()=>j(null)})})]})}export{ee as default};
