const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DetailsModal-CLJe_zgN.js","assets/react-query-BGeIQRPr.js","assets/react-CTDr35rJ.js","assets/DetailsView-BYm_lOqh.js","assets/format-CopOq-7K.js","assets/antd-DlFti5e9.js"])))=>i.map(i=>d[i]);
import{b as k,a as I,_ as P}from"./index-DvhTShKy.js";import{j as e,u as G}from"./react-query-BGeIQRPr.js";import{r as a}from"./react-CTDr35rJ.js";import{I as T,n as D,T as M,B as x,R as E,S as U,r as O,D as L}from"./antd-DlFti5e9.js";import{G as z}from"./GpuCard-_124Tsb-.js";import"./format-CopOq-7K.js";function R(){const v=a.useMemo(()=>new URLSearchParams(location.search),[location.search]),f=a.useCallback(()=>Object.fromEntries(v.entries()),[v]),o=a.useCallback(d=>{const n=new URLSearchParams(location.search);Object.entries(d).forEach(([m,h])=>{h===void 0||h===""?n.delete(m):n.set(m,String(h))}),history.replaceState({},"",`?${n.toString()}`)},[]);return{getAll:f,setAll:o}}function Q({onApply:v,onSortChange:f}){const{getAll:o,setAll:d}=R(),n=o(),[m,h]=a.useState(n.q||""),[t,j]=a.useState(n.min||""),[b,_]=a.useState(n.max||""),[g,N]=a.useState(n.brand||""),[c,S]=a.useState(n.vram_min||""),[u,C]=a.useState(n.condition||""),[l,y]=a.useState(n.sort||"price_desc");return a.useEffect(()=>{d({q:m,min:t,max:b,brand:g,vram_min:c,condition:u,sort:l})},[m,t,b,g,c,u,l,d]),e.jsxs("div",{className:"search-filters-container",children:[e.jsxs("div",{className:"filter-section",children:[e.jsx("label",{className:"filter-label",children:"Search"}),e.jsx(T,{placeholder:"Search title or description",value:m,onChange:r=>h(r.target.value),className:"filter-input"})]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("label",{className:"filter-label",children:"Sort by"}),e.jsx(D,{value:l,onChange:r=>{y(r),f(r)},className:"filter-select",options:[{value:"featured",label:"Featured"},{value:"best",label:"Best selling"},{value:"alpha_asc",label:"Alphabetically, A-Z"},{value:"alpha_desc",label:"Alphabetically, Z-A"},{value:"price_asc",label:"Price, low to high"},{value:"price_desc",label:"Price, high to low"},{value:"date_old",label:"Date, old to new"},{value:"date_new",label:"Date, new to old"}]})]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("label",{className:"filter-label",children:"Price Range"}),e.jsxs("div",{className:"price-inputs",children:[e.jsx(M,{placeholder:"Min price",value:t===""?void 0:Number(t),onChange:r=>j(r==null?"":String(r)),min:0,className:"price-input"}),e.jsx(M,{placeholder:"Max price",value:b===""?void 0:Number(b),onChange:r=>_(r==null?"":String(r)),min:0,className:"price-input"})]})]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("label",{className:"filter-label",children:"Brand"}),e.jsx(D,{value:g,onChange:r=>N(r),className:"filter-select",options:[{value:"",label:"Any brand"},{value:"NVIDIA",label:"NVIDIA"},{value:"AMD",label:"AMD"},{value:"Intel",label:"Intel"}]})]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("label",{className:"filter-label",children:"VRAM Range"}),e.jsx("div",{className:"vram-inputs",children:e.jsx(D,{value:c,onChange:r=>S(String(r)),className:"vram-input",placeholder:"Min VRAM",options:[{value:"",label:"Any VRAM"},{value:"4",label:"≥ 4GB"},{value:"6",label:"≥ 6GB"},{value:"8",label:"≥ 8GB"},{value:"12",label:"≥ 12GB"},{value:"16",label:"≥ 16GB"},{value:"24",label:"≥ 24GB"}]})})]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("label",{className:"filter-label",children:"Condition"}),e.jsx(D,{value:u,onChange:r=>C(r),className:"filter-select",options:[{value:"",label:"Any condition"},{value:"New",label:"New"},{value:"Used",label:"Used"}]})]}),e.jsxs("div",{className:"filter-actions",children:[e.jsx(x,{type:"primary",onClick:()=>{v({q:m,min:t,max:b,brand:g,vram_min:c,condition:u,sort:l,page:"1"})},className:"apply-btn",children:"Apply Filters"}),e.jsx(x,{onClick:()=>{h(""),j(""),_(""),N(""),S(""),C(""),y("price_desc"),f("price_desc"),v({q:"",min:"",max:"",brand:"",vram_min:"",condition:"",sort:"price_desc",page:"1"})},className:"clear-btn",children:"Clear all"})]})]})}const Z=a.lazy(()=>P(()=>import("./DetailsModal-CLJe_zgN.js"),__vite__mapDeps([0,1,2,3,4,5])));function ee(){var w;const{getAll:v,setAll:f}=R(),o=v(),[d,n]=a.useState(o.q||""),[m,h]=a.useState(o.sort||"price_desc"),[t,j]=a.useState({min:o.min||"",max:o.max||"",brand:o.brand||"",vram_min:o.vram_min||"",condition:o.condition||""}),[b,_]=a.useState(null),[g,N]=a.useState(!1),[c,S]=a.useState(Number(o.page||"1")),[u]=a.useState(12);a.useEffect(()=>k("Shop Everything — GPU Market"),[]);const C=a.useMemo(()=>{const s=new URLSearchParams;return d&&s.set("q",d),s.set("sort",m),Object.entries(t).forEach(([i,p])=>{p&&s.set(i,String(p))}),s.set("page",String(c)),s.set("per",String(u)),s},[d,m,t,c,u]),{data:l,isLoading:y,isError:r,refetch:$,isFetching:V}=G({queryKey:["search",d,m,t,c,u],queryFn:async()=>{f({q:d,sort:m,page:String(c),...t});try{const i=await(await I("/api/search?"+C.toString())).json().catch(()=>({})),p=Array.isArray(i.results)?i.results:[],A=Number(i.total||p.length||0),F=Number(i.page||c),q=Number(i.per||u);return{total:A,page:F,per:q,results:p}}catch{return{total:0,page:c,per:u,results:[]}}},placeholderData:s=>s,staleTime:3e4,retry:2});a.useEffect(()=>{const s=document.querySelector(".container");s&&s.scrollIntoView({behavior:"smooth",block:"start"})},[c]);function B(){P(()=>import("./DetailsModal-CLJe_zgN.js"),__vite__mapDeps([0,1,2,3,4,5]))}return e.jsxs("div",{className:"page-shop-everything container py-3",children:[e.jsx("div",{className:"filter-toolbar-gpused",children:e.jsxs("div",{className:"filter-header",children:[e.jsx(x,{onClick:()=>N(!0),className:"filter-sort-btn",icon:e.jsx("span",{className:"filter-icon",children:"☰"}),children:"Filter and sort"}),e.jsxs("span",{className:"product-count",children:[(l==null?void 0:l.total)||0," products"]})]})}),e.jsx("div",{children:e.jsxs("div",{children:[r&&e.jsx("div",{className:"my-4",children:e.jsx(E,{status:"error",title:"Failed to load list",subTitle:"Please try again later."})}),e.jsxs("div",{className:"product-grid",onMouseEnter:B,children:[(y||V)&&e.jsx(e.Fragment,{children:Array.from({length:8}).map((s,i)=>e.jsx("div",{className:"loading-card",children:e.jsx("div",{className:"loading-placeholder",children:e.jsx(U,{})})},i))}),!y&&(Array.isArray(l==null?void 0:l.results)?l==null?void 0:l.results:[]).map(s=>e.jsx("div",{children:e.jsx(z,{gpu:s,onDetails:async i=>{const A=await(await I(`/api/gpus/${i}`)).json();_(A)}})},s.id)),!y&&(((w=l==null?void 0:l.results)==null?void 0:w.length)||0)===0&&e.jsx("div",{children:e.jsx("div",{className:"my-4",children:e.jsx(E,{status:"info",title:"No results",subTitle:d||t.min||t.max||t.brand||t.vram_min||t.condition?"Try adjusting filters or sorting options.":"Browse by series from the top menu or apply filters to get started.",extra:d||t.min||t.max||t.brand||t.vram_min||t.condition?e.jsx("div",{className:"d-flex gap-2 justify-content-center",children:e.jsx(x,{onClick:()=>{n(""),j({min:"",max:"",brand:"",vram_min:"",condition:""}),S(1)},children:"Clear all filters"})}):e.jsxs("div",{className:"d-flex gap-2 justify-content-center",children:[e.jsx(x,{href:"/?brand=NVIDIA&vram_min=12",children:"NVIDIA 40 Series"}),e.jsx(x,{href:"/?brand=NVIDIA&vram_min=8",children:"NVIDIA 30 Series"}),e.jsx(x,{href:"/?brand=AMD&vram_min=12",children:"AMD 7000 Series"}),e.jsx(x,{href:"/?brand=AMD&vram_min=8",children:"AMD 6000 Series"})]})})})})]}),e.jsx("div",{className:"d-flex justify-content-center mt-3",children:e.jsx(O,{current:c,pageSize:u,total:(l==null?void 0:l.total)||0,onChange:s=>S(s),showSizeChanger:!1})})]})}),e.jsx(L,{open:g,onClose:()=>N(!1),placement:"right",width:"100%",className:"filter-drawer",title:"Filter and sort",closeIcon:e.jsx("span",{style:{fontSize:"24px"},children:"×"}),children:e.jsx(Q,{onApply:s=>{if(N(!1),s.sort){h(s.sort);const{sort:i,...p}=s;j(A=>({...A,...p}))}else j(i=>({...i,...s}));S(1)},onSortChange:s=>{h(s)}})}),e.jsx(a.Suspense,{fallback:null,children:e.jsx(Z,{item:b,onClose:()=>_(null)})})]})}export{ee as default};
