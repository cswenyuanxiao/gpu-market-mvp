const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ImageUploader-CZ84fFY_.js","assets/react-query-BGeIQRPr.js","assets/react-CTDr35rJ.js","assets/antd-DlFti5e9.js"])))=>i.map(i=>d[i]);
import{a as I,_}from"./index-DvhTShKy.js";import{j as e}from"./react-query-BGeIQRPr.js";import{i as T,r as o,u as M}from"./react-CTDr35rJ.js";import{F as a}from"./FormField-DCIQlhW3.js";import{u as P,a as B,C as p,o as O,s as h,c as w,e as R}from"./zod-SQF3v9p3.js";import{S as A,I as d,n as t,B as L}from"./antd-DlFti5e9.js";const $=o.lazy(()=>_(()=>import("./ImageUploader-CZ84fFY_.js"),__vite__mapDeps([0,1,2,3]))),k=["NVIDIA","AMD"],z=O({title:h().min(1,"Title is required"),price:w.number().min(1,"Price must be ≥ 1").max(5e5,"Price too large"),condition:R(["New","Used"]),brand:h().optional().refine(r=>!r||k.includes(r),"Brand must be NVIDIA or AMD"),vram:w.number().int().min(0,"VRAM must be ≥ 0").max(64,"VRAM must be ≤ 64").optional(),desc:h().max(2e3).optional()});function W(){var f,j,u,v,b,g;const{id:r}=T(),[D,S]=o.useState(!0),[E,F]=o.useState([]),C=M(),{register:c,handleSubmit:U,formState:{errors:n},reset:x,control:l}=P({resolver:B(z),defaultValues:{condition:"Used"}});o.useEffect(()=>{r&&(async()=>{try{const i=await(await I(`/api/gpus/${r}`)).json();x({title:i.title||"",price:i.price??"",condition:i.condition||"Used",brand:i.brand||"",vram:i.vram_gb??"",desc:i.description||""})}finally{S(!1)}})()},[r,x]);async function V(s){var y;if(!r)return;const i=new FormData;i.set("title",s.title),i.set("price",String(s.price)),i.set("condition",s.condition),s.brand&&i.set("brand",s.brand),s.vram!==void 0&&i.set("vram_gb",String(s.vram)),s.desc&&i.set("description",s.desc),E.slice(0,10).forEach(m=>i.append("images",m));const N=await I(`/api/gpus/${r}`,{method:"PUT",body:i});if(!N.ok){const m=((y=await N.json().catch(()=>({})))==null?void 0:y.error)||"Update failed";window.dispatchEvent(new CustomEvent("app-toast",{detail:{text:m,type:"error"}}));return}window.dispatchEvent(new CustomEvent("app-toast",{detail:{text:"Updated",type:"success"}})),C(`/g/${r}`)}return D?e.jsx("div",{className:"container py-3",children:e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(A,{size:"large"})})}):e.jsxs("div",{className:"form-container",children:[e.jsxs("div",{className:"form-description",children:[e.jsx("h3",{children:"Edit Listing"}),e.jsx("p",{children:"Update your GPU listing information below."})]}),e.jsxs("form",{onSubmit:U(V),className:"modern-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("div",{className:"section-title",children:"Basic Information"}),e.jsxs("div",{className:"form-grid",children:[e.jsx("div",{className:"form-field",children:e.jsx(a,{label:"Title",htmlFor:"title",error:(f=n.title)==null?void 0:f.message,children:e.jsx(d,{id:"title",...c("title")})})}),e.jsx("div",{className:"form-field",children:e.jsx(a,{label:"Price (£)",htmlFor:"price",error:(j=n.price)==null?void 0:j.message,hint:"≥ 1",children:e.jsx(d,{id:"price",type:"number",...c("price")})})}),e.jsx("div",{className:"form-field",children:e.jsx(a,{label:"Condition",htmlFor:"cond",error:(u=n.condition)==null?void 0:u.message,children:e.jsx(p,{name:"condition",control:l,render:({field:s})=>e.jsxs(t,{id:"cond",value:s.value,onChange:s.onChange,children:[e.jsx(t.Option,{value:"New",children:"New"}),e.jsx(t.Option,{value:"Used",children:"Used"})]})})})}),e.jsx("div",{className:"form-field",children:e.jsx(a,{label:"Brand",htmlFor:"brand",error:(v=n.brand)==null?void 0:v.message,hint:"NVIDIA, AMD, or Intel",children:e.jsx(p,{name:"brand",control:l,render:({field:s})=>e.jsxs(t,{id:"brand",value:s.value,onChange:s.onChange,allowClear:!0,children:[e.jsx(t.Option,{value:"NVIDIA",children:"NVIDIA"}),e.jsx(t.Option,{value:"AMD",children:"AMD"}),e.jsx(t.Option,{value:"Intel",children:"Intel"})]})})})}),e.jsx("div",{className:"form-field",children:e.jsx(a,{label:"VRAM (GB)",htmlFor:"vram",error:(b=n.vram)==null?void 0:b.message,hint:"0 - 64",children:e.jsx(d,{id:"vram",type:"number",...c("vram")})})})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("div",{className:"section-title",children:"Description"}),e.jsx("div",{className:"form-field form-field-full",children:e.jsx(a,{label:"Description",htmlFor:"desc",error:(g=n.desc)==null?void 0:g.message,children:e.jsx(p,{name:"desc",control:l,render:({field:s})=>e.jsx(d.TextArea,{id:"desc",rows:6,...s})})})})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("div",{className:"section-title",children:"Images"}),e.jsx(o.Suspense,{fallback:e.jsx(A,{}),children:e.jsx($,{onChange:F})})]}),e.jsx("div",{className:"form-actions",children:e.jsx(L,{type:"primary",htmlType:"submit",className:"submit-btn",children:"Save Changes"})})]})]})}export{W as default};
