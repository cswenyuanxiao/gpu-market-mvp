import{j as e}from"./react-query-BGeIQRPr.js";import{r as N,u as S,e as b,L}from"./react-CTDr35rJ.js";import{u as F,a as k}from"./index-DvhTShKy.js";import{F as l}from"./FormField-DCIQlhW3.js";import{u as E,a as I,o as P,s as u}from"./zod-SQF3v9p3.js";import{I as p,B as T}from"./antd-DlFti5e9.js";const C=P({username:u().min(1,"Username is required"),password:u().min(1,"Password is required")});function J(){var n,m;const[f,o]=N.useState(!1),h=S(),r=b(),{login:g}=F(),{register:a,handleSubmit:x,formState:{errors:i}}=E({resolver:I(C)});async function j(w){var c,d;o(!0);try{const t=await k("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)});if(!t.ok){const y=((c=await t.json().catch(()=>({})))==null?void 0:c.error)||"Login failed";window.dispatchEvent(new CustomEvent("app-toast",{detail:{text:y,type:"error"}}));return}const v=await t.json();g(v.token||""),window.dispatchEvent(new CustomEvent("app-toast",{detail:{text:"Logged in",type:"success"}}));let s;try{s=sessionStorage.getItem("from")||void 0,s&&sessionStorage.removeItem("from")}catch{}s||(s=(d=r==null?void 0:r.state)==null?void 0:d.from),s||(s="/my"),h(s,{replace:!0})}finally{o(!1)}}return e.jsxs("div",{className:"form-container",children:[e.jsxs("div",{className:"form-description",children:[e.jsx("h3",{children:"Welcome Back"}),e.jsx("p",{children:"Sign in to your GPU Market account to continue."})]}),e.jsxs("form",{onSubmit:x(j),className:"modern-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("div",{className:"form-field",children:e.jsx(l,{label:"Username",htmlFor:"login-username",error:(n=i.username)==null?void 0:n.message,children:e.jsx(p,{id:"login-username",...a("username")})})}),e.jsx("div",{className:"form-field",children:e.jsx(l,{label:"Password",htmlFor:"login-password",error:(m=i.password)==null?void 0:m.message,children:e.jsx(p.Password,{id:"login-password",...a("password")})})})]}),e.jsx("div",{className:"form-actions",children:e.jsx(T,{type:"primary",htmlType:"submit",loading:f,className:"submit-btn",block:!0,children:"Sign In"})})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsxs("p",{children:["New here? ",e.jsx(L,{to:"/register",children:"Create an account"})]})})]})}export{J as default};
